#!/usr/bin/env zsh
# ------------------------------------------------------------------------------
# .zshrc_android
# Android shell enhancements.
# Copyright 2009 - 2013 Stephen Niedzielski. Licensed under GPLv3.

# ------------------------------------------------------------------------------

# ------------------------------------------------------------------------------
#alias -g logcat=logcat\ -C

#apktool
#signapk

emu() {
  emulator -wipe-data -no-boot-anim -netspeed full -netdelay none "$@" -qemu -enable-kvm -cpu-delay 0
}

# $1 is actually a regex.
#adb_killall()
# {
#  adb shell ps|sed -rn "/ $1"'\r$/s_([^ ]+ +){2}([^ ]+).*_\1_p'|
#              #sed -rn 's_^[^ ]+ +([^ ]+) +([^ ]+ +){6}'"$1"'\r$_\1_p'
#  xargs -rd\\n adb shell su -c kill
#}

logcat_mq() {
  adb -d logcat -C|
  grep --line-buffered "$(adb -d shell ps|grep mapquest|awk '{print $2;}')"|
  grep --line-buffered -Ev 'MapQuest3DRenderer.onDraw|Animation Time|Ignoring label|moveCamera|it is not styled|acepoi|MapStyler|Label Collision|mq.scene.GeometryPrimitives|Gesture started|Gesutre ended|.mapgesturelistener'
}
alias pidcat=pidcat\ --color-gc


# TODO: really need to gather all my shell and android tips and tricks in one place.

# TODO: handle multi emus
adb_start() {
  adb shell "am start -S --activity-brought-to-front --activity-no-history -a android.intent.action.MAIN -c android.intent.category.LAUNCHER $*"
}

adb_snap() {
  monkeyrunner /dev/stdin <<EOF
from com.android.monkeyrunner import MonkeyRunner as m
from datetime import datetime

m                  . \
waitForConnection(). \
takeSnapshot()     . \
writeToFile(datetime.now().strftime('%Y-%m-%d-%H:%M:%S.png'),'png')
EOF
}

export LD_LIBRARY_PATH="$ANDROID_HOME/tools/lib"

#adb -s 731709ab shell find /extSdCard/audio -type f|s 's_\r$__; s_/extSdCard__;'|sort|cb
#find ~/Dropbox/audio -type f|s s_/home/stephen/Dropbox__|sort|cb
#adb -s 731709ab push Soundtracks/Diablo\ II\ Soundtrack/ /extSdCard/audio/Soundtracks/Diablo\ II\ Soundtrack/
