#!/usr/bin/env bash
# ------------------------------------------------------------------------------
# .bashrc_android
# Stephen Niedzielski
# Copyright 2011 Stephen Niedzielski. Licensed under GPLv3+.

# ------------------------------------------------------------------------------
alias logcat='adb logcat -v long'

# ------------------------------------------------------------------------------
# Magic for Remote Debugging

idu=2048 # $(id -u)
export ANDROID_ADB_SERVER_PORT=$((10000 + $idu)) # Use or create ADB server.
export ADBHOST=$ANDROID_ADB_SERVER_PORT # DDMS.
export ADT_BASE_PORT=$((13000 + ($idu - 2048) * 200)) # Eclipse base port.
export ADT_SELECTED_PORT=$(($ADT_BASE_PORT + 100)) # Eclipse VM port.
unset idu

# Note: for Eclipse, modify or add .metadata/.plugins/org.eclipse.core.runtime/
# .settings/com.android.ide.eclipse.ddms.prefs:
# - com.android.ide.eclipse.ddms.adbDebugBasePort
# - com.android.ide.eclipse.ddms.debugSelectedPort
# Also modify for DDMS in .android/ddms.cfg:
# - adbDebugBasePort
# - debugSelectedPort
# TODO: can I use setprop?

# ------------------------------------------------------------------------------

dump_apk_cert() { unzip -p "$1" META-INF/CERT.RSA; }
# TODO: support keystore.
# platform.x509.pem
# $(gettop)/extension/security
# $(gettop)/build/target/product/security
check_apk_cert()
{
  local pem="$1"
  local apk="$2"

  dump_apk_cert "$apk"|
  openssl pkcs7 -inform DER -outform PEM -print_certs|
  diff "$pem" -
}

export USE_CCACHE=1
export CCACHE_DIR=~/.ccache

alias apktool='java -jar ~/opt/apktool/apktool.jar'
